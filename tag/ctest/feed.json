{
    "version": "https://jsonfeed.org/version/1",
    "title": "NoResponse's Blog • All posts by \"ctest\" tag",
    "description": "成分复杂的CSer from ZJU",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/2025/11/20/note/20251201/",
            "url": "http://example.com/2025/11/20/note/20251201/",
            "title": "测试相关",
            "date_published": "2025-11-19T16:00:00.000Z",
            "content_html": "<h1 id=\"gtest\"><a class=\"markdownIt-Anchor\" href=\"#gtest\">#</a> gtest</h1>\n<p>Google 开源的 c++ 单元测试框架<br>\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9nb29nbGUuZ2l0aHViLmlvL2dvb2dsZXRlc3Qv\"> https://google.github.io/googletest/</span></p>\n<h1 id=\"查看代码覆盖率\"><a class=\"markdownIt-Anchor\" href=\"#查看代码覆盖率\">#</a> 查看代码覆盖率</h1>\n<ul>\n<li>GCC + gcov (cmake 一般带了) + lcov</li>\n</ul>\n<ol>\n<li>修改 CMakeLists.txt</li>\n</ol>\n<figure class=\"highlight cmake\"><figcaption><span>lcov</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 启用调试信息和覆盖率支持（仅在需要时开启）</span></span><br><span class=\"line\"><span class=\"keyword\">option</span>(ENABLE_COVERAGE <span class=\"string\">&quot;Enable coverage build&quot;</span> <span class=\"keyword\">OFF</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span>(ENABLE_COVERAGE)</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(CMAKE_CXX_COMPILER_ID <span class=\"keyword\">MATCHES</span> <span class=\"string\">&quot;GNU|Clang&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">target_compile_options</span>(your_library_or_source_files PRIVATE</span><br><span class=\"line\">            -O0          <span class=\"comment\"># 禁用优化（否则行号可能不准）</span></span><br><span class=\"line\">            -g           <span class=\"comment\"># 调试信息</span></span><br><span class=\"line\">            --coverage   <span class=\"comment\"># 等价于 -fprofile-arcs -ftest-coverage</span></span><br><span class=\"line\">        )</span><br><span class=\"line\">        <span class=\"keyword\">target_link_options</span>(your_library_or_source_files PRIVATE --coverage)</span><br><span class=\"line\">    <span class=\"keyword\">endif</span>()</span><br><span class=\"line\"><span class=\"keyword\">endif</span>()</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>构建并运行测试<br>\n…<br>\ncmake … -DENABLE_COVERAGE=ON<br>\n…</li>\n<li>生成可视化覆盖率报告（HTML）</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption><span>lcov</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 初始化覆盖率数据</span></span><br><span class=\"line\">lcov --capture --initial --directory . --output-file coverage_base.info</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 收集实际运行后的覆盖率</span></span><br><span class=\"line\">lcov --capture --directory . --output-file coverage_test.info</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 合并（可选，但推荐）</span></span><br><span class=\"line\">lcov --add-tracefile coverage_base.info --add-tracefile coverage_test.info --output-file coverage_total.info</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># （可选）过滤掉第三方代码（如 googletest）</span></span><br><span class=\"line\">lcov --remove coverage_total.info <span class=\"string\">&#x27;/usr/*&#x27;</span> <span class=\"string\">&#x27;*/thirdpart/*&#x27;</span> <span class=\"string\">&#x27;*/googletest*&#x27;</span> --output-file coverage_final.info</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 生成 HTML 报告</span></span><br><span class=\"line\">genhtml coverage_final.info --output-directory coverage_report</span><br></pre></td></tr></table></figure>\n<p>或者直接</p>\n<figure class=\"highlight bash\"><figcaption><span>lcov</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">make coverage</span><br></pre></td></tr></table></figure>\n<p>然后再 build 目录下的 coverage_html 目录下查看 index.html，可以点开具体文件查看哪些行没有覆盖到</p>\n<h1 id=\"如何提高单元测试的覆盖率\"><a class=\"markdownIt-Anchor\" href=\"#如何提高单元测试的覆盖率\">#</a> 如何提高单元测试的覆盖率</h1>\n<p>分析当前覆盖率报告，找出未执行的代码路径，然后编写新的测试用例来触发这些路径。</p>\n",
            "tags": [
                "ctest",
                "gtest",
                "test coverage"
            ]
        }
    ]
}